24.03.31
разработка Библиотеки (журнал выдачи книг), консоль

/* это значит - рассуждение не по теме
абстракция программы - использование неудаляемых? ресурсов (прокат, банк?, кредит?)
    ресурсы, пользователи, учет взаимодействия
    ведение ресурсов, пользователей, журнал взаимодействия

ресурс, пользователь: ключ, имя, атрибуты
ведение списка: показать(условие), найти(ключ, имя, атрибуты), добавить, удалить, изменить
взаимодействие: пользователь, ресурс, операция, дата-время, атрибуты

реализация абстракции
    интерфейсы: ведение, взаимодействие?
    классы: ресурс-список, пользователь-спислк, операция-журнал

реализация конкретной программы
    реальные классы создаются на базе абстрактных
    абстрактные классы представляют собой отдельный пакет
*/

/*
при разработке консольной программы встает вопрос
о стандартизации взаимодействия с пользователем
    задание команд (меню)
    ввод данных (приглашения, проверки, обработка ошибок)

представляется разумной такая структура программы (иерархическая)
каждой группе команд соотвествует класс (groupNameCommands)
в этом классе содержатся
    объекты предметных классов с которыми выпоняются команды
    меню команд (subclass базового абстрактного меню)
    методы выполнения команд

у абстрактного меню могут быть наследники - стандартные меню (ведение списка)
тогда конкретное меню может быть наследником стандартного меню
и класс может быть наследником стандартного класса (editCommands)
*/

/*
некоторые вещи можно реализовать через наследование
и через обобщения
по возможности, используем наследование (почему?)
*/

классы
    автор
    книга
    экземпляр
    читатель
    запись журнала (журнал?)

шаг 1: редактирование авторов, книг, читателей

итак, поехали, со всей музыкой, сверху вниз
из main создаем LibraryCommands и запускаем
    LibraryCommands : MenuCommands
    содержит Library,
    задает команды меню (Clients, Authors, Books, Exit)
    по командам  создаем и запускаем ClientsCommands, BooksCommands ...
    которые : EditCommands<T>

параллельно надо
    IItem, IItemList
    Item, ItemList
и на базе их строить Clients Authors Book
и списки...
пока в одном проекте, потом разделим

24.04.01
меню реализовано как базовый класс
реальные меню - наследники с добавлением команд

дальше - реализация авторов и книг
делаем прямую реализацию, смотрим, что можно обобщить
и реализуем интерфейсы и абстрактные классы

= вывод на экран - show
= вывод меню отделить визуально
= строка автора выводится дважды
= формирование меню - метод fillCommands

команды (для авторов)
    добавить (со вводом), удалить(ид), редактировать (со вводом),
    =показать(ид), =показать все, =показать(фамилия:часть)
    =показать(фамилия, имя:часть)

интерфейс
    добавать, удалить, изменить
    показать(ид), показать все,
    показать(условие) = показать(тип объекта, предикат)

дальше
    сделать Books
    сделать обобщение
    сделать Authors,Books,Readers через обобщения

24.04.02
    нужен ли интерфейс? ConsoleList
    showAll showItem
    add remove update
    showByName showNames

    обобщение
    создаем абстрактный? класс ListCommands
    добавляем вложенный класс Item
    и список ItemList<Item>
    в дочернем классе
        наследуем Item
        список остается

24.04.03
    сделали интерфейс
    сделали класс ListCommands(Items)
    получили subclass Humens(Humens.Item)
    заработало

= продумать правильный порядок команд в меню
= список неверно выводится
= добавить автоматическую работу с id

дальше
    разобраться с сериализацией
    сделать авторов на базе ListCommands
    сделать BooksCommands
    ? сделать CopiesCommands

    приступить к журналу

    приступить к БД

24.04.04
    правильные имена
        пакет console
            IList, ListCommands, ListCommands.Item
            Commands, Commands.Item
        пакет console.library
            commands.Main
            HumansCommands, HumansCommands.Item
            BooksCommands, BooksCommands.Item
            etc.
            с журналом будет ясно позже

    как изменить
        создать новый проект, папки и файлы
        и перенести код
    вообще-то это 2 проекта...
    когда все заработает
        перенесем console в отдельный проект

    итак, сериализация...
    https://www.baeldung.com/java-serialization
    там, где у нас ссылка на список, нужно
        при записи запомнить id
        при чтении по id найти объект в списки
            и установить на него ссылку
    то есть, для объектов со ссылками
        нужно переопределять методы сериализации

    https://mvnrepository.com/artifact/com.fasterxml.jackson.core
    // custom
    https://mvnrepository.com/artifact/com.fasterxml.jackson.datatype?p=1

    https://blogs.oracle.com/javamagazine/post/java-json-serialization-jackson
    https://www.baeldung.com/java-serialization
    https://www.baeldung.com/jackson-object-mapper-tutorial
    https://www.baeldung.com/jackson-deserialize-json-unknown-properties

    @JsonIgnoreProperties(ignoreUnknown = true)
    new ObjectMapper().configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false)

    /*
    однако: статический фабричный метод of(...)
    такой метод может возвращать объекты разых subclass

    возможно могут быть полезны record
    как изменить запись? так же, как String
        создать новую запись с измененными полями
        статический метод bookRector(bookRecord
    */

24.04.05
    =сериализация Humans
    =Books
    добавить дату рождения
    Copies
    Log
    ? несколько авторов

    Books
        все стандартные команды
        showAllAuthors
        showAuthorBooks
        нам нужно вызвать getAuthors().showAll() ?

    что у нас вообще происходит
    main создает и запускае меню Library
        команды которого запускают меню Authors
            команды которого (HumanCommands)
                выполняют операции с Authors
                через методы, определенные в ListCommand
                и переопределенный в HumanCommands

    как вызвать операцию с Authors из другого объекта?
        нужно иметь доступ к объекту HumanCommands
        но у нас его нет
        либо создать (как в getAthors)
        примерно так
            new HumansCommands(library.getReaders()).showAll();
        либо иметь в Library и передавать как параметр

простую сериализацию выполнили
книги добавили

24.04.09
дальше
    Books
        =поправить toString
        =showAllAuthors
        =showAuthorBooks
        проверить обработку ошибок
        =books serialization
            // сохранять id author
            // при чтении подсоединять автора
            // нужно переопределять сериализацию
            =после чтения
            =устанавливать ссылку на автора

-------------------------------------------------------
список доработок
!! update по Enter оставить прежнее значение
    (возможно посредством readUpdate...)
! добавить к Exit имя меню
! добавить в любой командный метод возможность отмены
    (ввод только String и, скажем, первый символ - Esc)
    (возможно на уровне read...)
? показывать уровень меню
? варианты меню: вертикально / горизонтально
?? изменить имена классов
??? Commands можно переписать над IListCommands
-------------------------------------------------------

24.04.16
дальше
    добавить дату рождения в Reader
    класс Copies
    класс Log
    ? несколько авторов
    запросы (в каком/каких) классе

для добавления даты в Reader нужно было
    создать наследника Humen
    показалось, что для этого следует вынести предметные классы из команд
    для этого нужно было много чего поменять...
    в результате проект сломался...

пришходится отойти назад и разбежаться...

итак с меню все более-менее нормально
а вот предметные классы должны быть отдельно
и, похоже, меню должно быть и с наследованием и с обобщениями...

структура программы - это структура объектов
    с которыми работает программа
 в нашем случае
    все(библиотека) > стратегические данные (списки: авторы, книги, экземпляры, экземляры)
        оперативные данные (журнал)
радом со структурой данных находится структура действий с данными (структура команд меню)
она не соотвтествует структуре данных
навигация у нас по структуре команд
команды имеют доступ к нужным данным
возможно, у нас в main
    library
    commands
глобальные статические объекты
команды объединяются в грууппы
команда представляет собой совокупность подсказок, вводов, выводов
и взаимодействий со структурой данных
и это метод...

группа команд (Commands/Menu) - это класс
в котором собирается список комманд
этот список может повторяться
    но код команд - разный (аннотации?)
тогда мы получаем базовый класс с переопределениями

делаем так же - авторы, книги и т.д.
пакеты: команды, библиотека

24.04.17
предметые классы
    IdItem и производные от него
        toString
    IdList и производные ?
        add
        remove
        find
командные классы
    Commands - шаблон группы команд, из которых выполняется выбор
        + статические элементы
    <Group>Commands - конкретная группа команд
        вместе с методами реализации
        должна быть возможность наследования
            в конструкторе другой набор команд
            другие методы реализации
            другой набор полей ?
                заменить поля методами доступа к статическому пулу данных ?
    пожалуй получится
дальше
    =MainCommands : Commands, Commands
    =IdNameListCommands, IdNameList, IdName
    AuthorsCommands, AuthorList, Author
    BooksCommands, Books, Book
    HumansCommands, Humans, Human
    ReadersCommands, Readers, Reader

-------------------------------------------------------
наследуем автора
список авторов - generic
наследуем список команд

24.04.23
авторы вроде рабтают
= ошибку id нужно отлавливать раньше
книги - работает
=обновление ссылок при загрузке (books)

24.04.24
дальше:
    =читатели с датой рождения
    =экземляры
    ряд update
    журнал


24.04.27
дальше:
    ряд update
    журнал
    запросы
    доработки

 обработка ошибок
    отлавливаем все в вызове команды
    возможные варианты выполнения команд
        ошибка выбора команды
            сообщение, повторение меню
        отмена команды (специальный символ)
            повторение меню
        ошибка ввода данных
            сообщение, повторение ввода
        ошибка поиска объекта

как организовать отмену команды
и повторение значения при изменении
и то, и другое не может быть одним и тем же Enter
лучше конечно специальный знак повторения
например =

=! нет данных библиотеки
=выводить имя меню

24.05.19
=======================================================
список доработок
! журнал
! несколько авторов
! дополнительные запросы
?? можно в Commands добавить remove, update, insert
??? Commands можно переписать над IListCommands
??? разобраться с Optional
    https://www.baeldung.com/java-optional
? разобраться с необрабатываемым исключением
=======================================================
тестирование
    меню: выбор, выход(пусто), не цифра, ошибка
    ввод
        строка: ввод, выход
        число: ввод, выход, не цифра, ошибка
        ид: ввод, выход, не цифра, ошибка
    редактирование
        строка: выход - должна быть замена
        число:
        ид:
    команды: printA, add, rem, upd, print, printN
    спецКоманды: printAB

    =при редактировании неправильно обрабатывается ссылка на id

